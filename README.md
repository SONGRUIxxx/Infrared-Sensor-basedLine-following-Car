# 综合设计与实践A综合实验设计报告

## 摘要
本项目以 STM32G030C8T6 单片机为控制核心，设计并实现了一款集成传感器系统、电机驱动与电源管理的双轮迷宫机器鼠，旨在完成前进、后退、变速、转向、避障及巡线等功能。硬件上，采用 TPS5430DDAR 将 6V 输入电压转换为 3.3V 系统电压，通过两片 TC118S 驱动双电机，8 个 ITR20001 红外传感器（4 个避障、4 个巡线）均以 ADC 方式采集模拟信号以提升感知精度；软件上基于 PD 算法计算电机转速差，结合定时器 PWM 输出与 DMA 传输实现高效控制。经调试，确定 KP=0.14、KD=0.1 为最优控制参数，机器鼠可在白色 KT 板（20~25mm 黑色胶带）场景中稳定巡线，且能及时响应避障需求，所有电路集成于单块定制 PCB，满足项目技术指标。

---

## 一．题意分析
### 1. 项目背景
本项目旨在基于STM32G030C8T6单片机为核心控制器，设计并制作一个能够自主在迷宫中导航的双轮智能机器鼠。该机器鼠需集成传感器系统、电机驱动、电源管理于一体，最终实现包括前进、后退、变速、原地转向、行进转向、避障、巡线在内的完整运动控制功能。

项目要求所有电子电路均集成于一块自主设计的PCB之上，严禁使用现成的功能模块，以全面考察硬件设计、嵌入式软件编程及系统集成能力。

### 2. 主要技术指标
1. 主控芯片：STM32G030C8T6单片机。
2. 电源系统：6V输入，TPS5430DDAR降压至3.3V。
3. 电机驱动：两片TC118S独立驱动双轮。
4. 传感器系统：8个ITR20001红外传感器（4避障+4巡线，ADC采集）。
5. PCB设计：所有电路集成于一块定制PCB。

---

## 二．原理分析
### 1. 运动控制原理
两轮差速模型，通过调节左右轮转速差实现转向。

### 2. 红外传感原理
ITR20001集成红外发射与接收，反射强度转为电压，ADC采集用于避障与巡线。

### 3. PWM调速原理
STM32定时器输出PWM，经TC118S调速，实现电机连续可调。

### 4. 方案比较
- 红外读取：GPIO（二元）vs ADC（模拟量），选ADC。
- 运动算法：PID vs PD，选PD（简化、抑制震荡）。

---

## 三．电路实现
### 1. 原理图
（详见原理图工程文件夹）

### 2. 局部分析
- 单片机模块：PA0~PA7为ADC，PA8~PA11为PWM，PD2为调试LED。
- 红外模块：发射端串330R，接收端上拉10K。
- 电源：R1=10K，R2=5.9K设定3.3V输出。
- 电机驱动：TC118S控制双轮。

---

## 四．软件算法
### 1. 代码流程
- 初始化：GPIO、DMA、ADC、TIM。
- 启动PWM、ADC DMA。
- 主循环：
  - 检查adc_ready。
  - 若有障碍物（adc[0~3]<阈值）：亮LED，调用bizhang()避障。
  - 否则：
    - 计算averange=adc[4]+adc[5]-adc[6]-adc[7]。
    - PD算法计算speed=KP*averange+KD*(averange-averange_last)。
    - 限幅后调用move(speed)。
  - 20ms周期。

### 2. 关键参数
- KP=0.14，KD=0.1。

---

## 五．测试方法、结果与分析
- 硬件确认、场景搭建。
- 调试顺序：先KP后KD，目标为无偏移巡线、平滑过弯、及时避障。
- 最终参数下，机器鼠在标准场景下表现稳定。

---

## 六．总结
- 硬件集成化，电路布局合理。
- 采用ADC采集提升感知精度。
- PD算法简化控制，满足动态性能。

---

## 附录A：电路原理图及PCB
详见原理图工程文件夹。
